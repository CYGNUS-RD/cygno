#!/usr/bin/env python3
#
# G. Mazzitelli 2021
#

__version__ = '1.0'

import re
import sys
import os

import numpy as np
import time
import datetime
from optparse import OptionParser
import cygno as cy
import json

##############################
########### Main #############
##############################
def main():
    parser = OptionParser(usage='usage: %prog\t [-jv] [run]')
    parser.add_option('-j','--json', dest='json', type='string', default='', help='json output;');
    parser.add_option('-v','--verbose', dest='verbose', action="store_true", default=False, help='verbose output;');
    (options, args) = parser.parse_args()
    #
    if options.verbose: 
        print(">> resquested arguments:", args)
        print(">> resquested options:", options)
    #       
#    if len(args) > 2:
#        parser.error("incorrect number of arguments")
        
    if len(args) < 1:
        db = cy.read_cygno_sql_logbook(verbose=options.verbose)
        #print(db)
        for index, row in db.iterrows():
            print (row)

    else:
        db = cy.run_info_logbook(int(args[0]), sql=True, verbose=options.verbose)
        
        if options.json:
            print(json.dumps(db.to_json()))
            
        else:
            for i, column in enumerate(db.columns):
                print("{column}: {value}".format(column=column, value=db[column].values[0]))
            
            
if __name__ == "__main__":
    main()
